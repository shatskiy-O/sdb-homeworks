# Домашнее задание к занятию «Резервное копирование баз данных»

**Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.** 

Для оформления вашего решения в GitHub можете воспользоваться [шаблоном](https://github.com/netology-code/sys-pattern-homework).

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

---

### Ответ 1. Резервное копирование

1.1. Для восстановления данных в полном объёме за предыдущий день:

Полное Резервное Копирование (Full Backup): Ежедневно создавать полные копии всех данных. Это позволяет восстановить все данные на момент времени, когда была создана копия, но требует значительных ресурсов и времени.
Дифференциальное Резервное Копирование (Differential Backup): Копировать только те данные, которые изменились с момента последнего полного резервного копирования. Позволяет быстрее восстановить данные, чем при использовании только полных копий, но восстановление всё ещё может занять много времени.
1.2. Для восстановления данных за час до предполагаемой поломки:

Часовое Инкрементальное Резервное Копирование (Incremental Backup): Копирование всех данных, которые изменились с момента последнего инкрементального резервного копирования (обычно каждый час). Это требует меньше времени и ресурсов, чем полное копирование, и позволяет восстановить данные с минимальной потерей.
Снимки (Snapshots): Регулярные снимки состояния системы также позволяют быстро восстановить данные.
1.3. Моментальное Переключение на Работающую или Починенную Базу Данных:

Репликация Базы Данных (Database Replication): Позволяет иметь одну или несколько копий базы данных, которые могут быть немедленно использованы при сбое основной базы данных. Репликация может быть синхронной или асинхронной.
Кластеризация Баз Данных (Database Clustering): Объединение нескольких серверов баз данных в кластер позволяет автоматически переключаться на запасной сервер в случае сбоя основного.
Облачные Решения (Cloud Solutions): Использование облачных сервисов, таких как Amazon RDS или Google Cloud SQL, также может обеспечить автоматическое восстановление и переключение баз данных.
Итог:
Для максимальной эффективности и надежности, компании стоит использовать комбинацию методов резервного копирования и технологий, таких как полное и инкрементальное копирование, репликация и кластеризация, а также облачные сервисы для автоматического восстановления и переключения между базами данных. Это обеспечит надежное и быстрое восстановление данных после поломки, с минимальными потерями данных и временем простоя.


### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

---

### Ответ 2. PostgreSQL

#### 2.1. Резервирование данных и восстановление БД с использованием pg_dump/pg_restore

##### Резервирование данных:
```postgresql
pg_dump -U username -W -F t dbname > dbname.tar
```

##### Восстановление БД:
```postgresql
pg_restore -U username -d dbname -1 dbname.tar
```

##### 2.1*. Автоматизация процесса
```
crontab -e
0 2 * * * /usr/bin/pg_dump -U username -W -F t dbname > /path/to/backup/dbname_$(date +\%F).tar
```


### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

---


### Ответ 3. MySQL

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

##### 3.1. Инкрементное Резервное Копирование MySQL

```
mysqlbinlog --start-datetime="2023-09-30 00:00:00" --stop-datetime="2023-09-30 23:59:59" --result-file=incremental_backup.sql /var/lib/mysql/binlog.000001
```

##### 3.1*. Преимущества Репликации перед Обычным Резервным Копированием

Минимизация Времени Простоя:
Репликация обеспечивает высокую доступность, так как при сбое основной базы данных трафик может быть направлен на реплику.
Распределение Нагрузки:
Реплики могут использоваться для распределения нагрузки чтения, улучшая тем самым общую производительность системы.
Более Быстрое Восстановление:
Репликация может обеспечить более быстрое восстановление после сбоя по сравнению с восстановлением из резервной копии, особенно если резервная копия устарела.
Облегчение Процесса Резервного Копирования:
Резервные копии могут быть созданы с реплики, снижая тем самым нагрузку на основной сервер базы данных.
Реальное Время:
Репликация происходит в реальном времени, что обеспечивает доступ к самым актуальным данным, в отличие от резервного копирования, которое может содержать устаревшую информацию.
Вывод:
Хотя репликация имеет много преимуществ, она не заменяет резервное копирование. Оба метода следует использовать вместе для обеспечения надежности, доступности и целостности данных. Резервные копии необходимы для восстановления данных в случае катастрофических сбоев или повреждений данных, таких как удаление данных или атаки ransomware.
